# 组件和组件属性

组件：包含内容、样式和功能的UI单元

## 创建一个组件
1. 函数组件

返回一个React元素

2. 类组件

必须继承React.Component

必须提供render函数，用于渲染组件

## 组件的属性

1. 对于函数组件，属性会作为对象的属性，传递给函数的参数
2. 对于类组件，属性会作为一个对象的属性，传递给构造函数的参数

注意：组件的属性，应该使用小驼峰命名

**组件无法改变自身的属性**

之前学习的React元素，本质上，就是一个组件（内置组件）

React中的哲学：数据属于谁，谁才有权力改动

**React中的数据，是自顶而下流动的**


## 组件状态

组件状态：组件可以自行维护的数据

组件状态仅在类组件中有效

状态（state），本质上是类组件的一个属性 （对象）

**状态初始化**

**状态的变化**
不能直接改变状态：因为React无法监控到状态发生了变化

必须使用this.setState({})改变状态

一旦调用了this.setState，会导致组件重新渲染

**组件中的数据**

1. props: 该数据是由组件的使用者传递的数据，所有权不属于组件自身，因此组件无法改变该数据
2. state: 该数据是由组件自身创建的，所有权属于组件自身，因此组件有权改变该数据

## 事件

在React中，组件的事件，本质上就是一个属性

按照之前React对组件的约定，由于事件本质上是一个属性，因此也需要使用小驼峰命名法

**如果没有特殊处理，在事件处理函数中，this指向undefined**

1. 使用bind函数绑定，绑定this【2种写法】
  ```js
  //第一种：处理this为undefined问题
    constructor(props){
    super(props)
    this.handleClick = this.handleClick.bind(this);
    this.handleOver = this.handleOver.bind(this);
  }
  ```

  ```js
  //第二种：
  onOver={this.handleOver.bind(this)}
  ```
  相比较而言，第一种效率高，渲染时只创建一次，而第二种每次都创建

2. 使用箭头函数【2种写法】

```js
//第一种
onClick={() => {console.log('点击了')}}
```

```js
//第二种 结果：handleClick不在原型上，而在对象上
  handleOver = () => {
    this.setState({
      isOver: true
    })
  }
  ```

  ## 深入认识setState

  setState,它对状态的改变，**可能**是异步的

  > 如果改变的代码处于某个HTML元素的事件中，则其是异步的，否则是同步

  如果遇到某个事件中，需要同步调用多次，需要使用函数的方式得到最新状态

  最佳实践：

  1. 把所有的setState当作是异步的
  2. 永远不要信任setState调用之后的状态
  3. 如果要使用改变之后的状态，需要使用回调函数(setState的第二个参数)
  4. 如果新的状态要根据之前的状态进行计算，使用函数的方式改变状态（setState的第一个函数）

  React会对异步的setState进行优化，将多次setState进行合并（将多次状态改变完成后，再统一对state进行改变，然会触发render）

## 生命周期

生命周期：组件从诞生到销毁会经历一系列的过程，该过程就叫生命周期。React在组件的生命周期中提供了一系列的钩子函数（类似于事件），可以让开发者在函数中注入代码，这些代码会再适当的时候运行。

**生命周期仅存在于类组件中，函数组件每次都是重新运行函数，就的组件即刻被销毁**

### 旧版生命周期

React < 16.0.0


1. constructor
  1. 同一个组件对象只会创建一次
  2. 不能在第一次挂载到页面之前，调用setState,为了避免问题，构造函数中严禁使用setState
2. componentWillMount
  1. 正常情况下，和构造函数一样，它只会运行一次
  2. 可以使用setState,但是为了避免bug，不允许使用，因为在某些特殊情况下，该函数可能被调用多次（渲染终端取消、服务端渲染）
3. **render**
  1. 返回一个虚拟DOM，会被挂载到虚拟DOM树中，最终渲染到页面的真实DOM中
  2. render可能不只运行一次，只要需要重新渲染，就会重新运行
  3. 严谨使用setState，因为可能会导致无限递归渲染
4. **componentDidMount**
  1. 只会执行一次
  2. 可以使用setState
  3. 通常情况下，会将网络请求/启动计时器等一开始需要的操作，书写到该函数中
5. 组件进入活跃状态
6. componentWillReceiveProps
  1. 即将接收新的属性值
  2. 参数为新的属性对象
  3. 该函数可能会导致一些bug，所以不推荐使用
7. **shouldComponentUpdate**
  1. 指示React是否要重新渲染该组件，通过返回true和false来指定
  2. 默认情况下，会直接返回true
8. componentWillUpdate
  1. 组件即将被重新渲染 
9. componentDidUpdate
  1. 往往在该函数中使用dom操作，改变元素
10. **componentWillUnmount**
  1. 通常在该函数中销毁一些组件依赖的资源，比如计时器
### 新版生命周期 

React >= 16.0.0